#!/bin/zsh
set -e
usage="Usage: <package>"
package="$1"

if [ -z "$package" ]
then
  echo "$usage"
  exit 1
fi

regularDep=$(cat package.json | json "dependencies['$package']")
devDep=$(cat package.json | json "devDependencies['$package']")

if [ "$devDep" ]; then
  echo "$package is a devDependency."
  flag='-D'
else
  if [ "$regularDep" ]; then
    echo "$package is a dependency."
    flag='-S'
  else
    echo "$package is not a depencency!"
    exit 1
  fi
fi

latest=$(npm info "$package" version)
range="^$latest"

echo "Latest $package is $latest."

npm install "$flag" "$package@$range"
#npm it
git add package.json
if [ -f npm-shrinkwrap.json ]; then
  npm shrinkwrap
  git add npm-shrinkwrap.json
fi
if [ -f package-lock.json ]; then
  if git ls-files | fgrep package-lock.json; then
    git add package-lock.json
  fi
fi
git commit -m "$package@^$latest"
