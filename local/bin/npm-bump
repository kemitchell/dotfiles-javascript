#!/bin/zsh
set -e
usage="Usage: <package> [--dev]"
package="$1"

if [ -z "$package" ]
then
  echo "$usage"
  exit 1
fi

devDep=$(cat package.json | json "devDependencies.$package")

if [ -z "$devDep" ]
then
  flag='-D'
else
  flag='-S'
fi

latest=$(npm info "$package" version)
range="^$latest"

echo "Latest $package is $latest."

npm install "$flag" "$package@$range"
npm it
git add package.json
if [ -f npm-shrinkwrap.json ]; then
  npm shrinkwrap
  git add npm-shrinkwrap.json
fi
git commit -m "$package@^$latest"
