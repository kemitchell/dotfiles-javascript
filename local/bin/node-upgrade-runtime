#!/bin/bash
STABLE=v$(curl http://semver.io/node/stable)
INSTALLED=$(node --version || echo '')
REPO=$PREFIX/source/node
SOURCE=$(dirname $REPO)
GIT="https://github.com/joyent/node"

if [ "$STABLE" = "${INSTALLED%%\\n}" ]; then
	echo "node@$STABLE is already installed"
	exit 0
else
	banner "Installing node@$STABLE"
	mkdir -p "$SOURCE"

	if [ -d "$REPO" ]; then
		echo "Already checked out"
		cd "$REPO"
		make distclean
	else 
		git clone "$GIT" "$REPO"
		cd "$REPO"
	fi

	sudo apt-get update
	sudo apt-get -y install build-essential curl libssl-dev openssl

	git checkout "$STABLE"
	cmi
	npm install --global npm

	which node
	node --version
	which npm
	npm --version
fi
